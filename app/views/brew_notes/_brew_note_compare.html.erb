<h1><%= brew_note.created_at.to_datetime.strftime('%d/%m/%y %l:%M') %></h1>
<h2>Mash Notes</h2>

<div id="chart-div-<%= brew_note.id %>"></div>
<h2>Boil Notes</h2>

<p>Boil notes will go here</p>

<h2>Fermenting Notes</h2>
<p>Fermenting chart will go here</p>

<h2>Tasting Notes</h2>
<% if brew_note.tasting_notes.first %>
  <%= render partial: "tasting_notes/flavor_wheel",
             locals: {tasting_note: brew_note.tasting_notes.first} %>
<% else %>
<p>Take some tasting notes!</p>
<% end %>
<script>
  $(function(){
    var noteData = <%= brew_note.mash_notes.to_json.html_safe %>;

    // parse noteData to be used by google's arrayToDataTable
    noteData = _.map(noteData, function(mash_note){
      return [mash_note.time, mash_note.temperature]
    });
    // filter out undefined points
    noteData = _.select(noteData, function(note){
      return note[0] != undefined && note[1] != undefined
    })

    //sort by time
    noteData = _.sortBy(noteData, function(note){
      return note[0]
    })
    // Add first row
    noteData.unshift(["Time", "Temperature"])

    var options = {
      title: 'Time vs. Temperature',
      hAxis: {title: 'Time (minutes)', minValue: 0, maxValue: 60 },
      vAxis: {title: 'Temperature (Fahrenheit)', minValue: 100, maxValue: 200},
      legend: 'none',
      lineWidth: 1,
      animation: {duration: 250, easing: "linear"}
    };

    var chart = new google.visualization.
                    ScatterChart($('#chart-div-<%= brew_note.id %>')[0]);
    if (noteData.length > 1){
      animateChart(noteData, options, chart, 300)
    }
    else {
      $("#chart-div-<%= brew_note.id %>").append("<p>Add some mash notes</p>")
    }


  });

</script>