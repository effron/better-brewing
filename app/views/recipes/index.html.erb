<header>
  <p>Welcome to Better Brewing!</p>
  <p>To get started, select a recipe below, or upload your own.</p>
  <p>Start brewing better beer!</p>
</header>

<div id="recipes-index">
  <div id="search-field">
    <%= form_tag recipes_url, method: "get", remote: true do %>
      <%= text_field_tag :search, params[:search] %>
      <%= submit_tag "Search", name: nil %>
    <% end %>
  </div>
  <div id="recipe-list">
    <h1>All Recipes</h1>
    <%= paginate @recipes %>
    <ul class="recipe-tiles group">
      <%= render @recipes %>
    </ul>
    <%= paginate @recipes %>
  </div>
</div>

<script>
$(function(){

  var timer = null

  $("#search-field").on("ajax:success", function(event, data){
    $(event.target).removeClass("ajax-waiting")
    $("#recipe-list").html(data)
  })

  $("#search-field").on("ajax:error", function(event, xhr, status, error){
    $(event.target).removeClass("ajax-waiting")
  })

  $("#search-field").on("ajax:before", function(event, data){
    $(event.target).addClass("ajax-waiting")
  })

  $("#search-field").on("keyup", function(){
    if (timer) {
      window.clearTimeout(timer);
    }
    timer = window.setTimeout( function(){
      timer = null;
      $("#search-field form").submit();
    }, 400 );
  });

})


</script>